# Описание семестрового проекта по MLOps MIPT 2024


## Структура репозитория 

``` bash
├── commands.py                     => Консольное приложение для запуска train или inference стадии
├── config                          => Конфиг, содержащий переменные параметры обучения и инференса
│   ├── conf.yaml
│   ├── __init__.py
├── Dockerfile                      => Докерфайл для сборки валидного окружения
├── faces_data.dvc                  => DVC артефакты датасета
├── .dvc                            => DVC артефакты датасета
├── README.md
├── requirements.txt                => Список необходимых зависимостей
└── utils                           => Папка с утилитами
    ├── datasets.py                 => Кастомные датасеты в torch-абстракциях
    ├── infer.py                    => Инференс пайплайн
    ├── model.py                    => Реализация архитектуры
    ├── pl_dataset.py               => Кастомные датасеты в абстракции LightningDataModule
    ├── pl_training_module.py       => Цикл обучения в абстакции LightningModule
    └── train.py                    => Полный пайплайн обучения
```

## Формулировка задачи

В данном проекте поставлена задача опромышлить и обернуть в репозиторий
инудстриального уровня модель глубокого машинного обучения.

Используются результаты разработанного мной ранее CV проекта.
Модель решает задачу определения координат четырнадцати ключевых точек на фотографии
лица человека:

- Края глаз
- Зрачки
- Края бровей
- Уголки и центр губ

Решение подобных задач имеет крайне прикладной характер, в силу развития различных
биометрических технологий - маски для фото/видео, биометрическая верификация,
распознование лица с изображений камер и т.д.

## Данные для моделирования

Примером датасета может служить данное
[соревнование на Kaggle](https://www.kaggle.com/c/facial-keypoints-detection/data).
Единственное критичное отличие используемого в работе датасета заключается в
разметке (в соревновании на картинках размечено 15 ключевых точек, в то время как
модель в этом проекте работает для случая 14-ти точек)
Обучающая часть содержит 6к изображений, что является вполне достаточным объёмом 
выборки, особенно если применять искусственное расширение датасета 
при помощи добавления аугментаций (поворот картинки, изменение перспективы,
частичный дропаут пикселей и т.д.). Еще одно достоинство данного датасета -
разнообразность представленных изображенний (среди данных встречаются лица людей
всех возрастов и различных рас), что не позволит модели переобучиться на конкретном
"типе данных"


## Подход к моделированию

### Архитекруты
В данном проекте релизовано решение задачи поиска ключевых точек лица с
помощью архитектуры свёрточной нейросети [ResNet18](https://www.researchgate.net/figure/Original-ResNet-18-Architecture_fig1_336642248).
Модель реализована на уровне абстракций nn.Module фреймворка pytorch 
(а не импортирована готова архитектура). Как показали эксперименты - такой архитектуры
вполне достаточно для того, чтобы получать неплохое качество в рамках поставленной
задачи, так что нет особенной нужны в усложнении модели.


### Обучение
Предполагается подготовть `.py`-скрипт для обучения модели, логгирования этого
процесса и сохранения контрольных точек во время обучения.

Основной инструмент для этого - `pytorch-lightning`, в который будет 
обёрнута модель. Запуск `.py`-скрипта предполагается осуществлять в контейнере,
где будут также располагаться данные для обучения, директории для чекпоинтов модели
и будут зафиксированы все версии используемых пакетов.

Для логгирования процесса обучения предполагается использования `mlflow`.

## Предсказания

В силу спецефичности результатов инференса модели (координаты ключевых точек лица)
предполагается, что в реальном промышленном пайплайне будут существовать дальнейшие
шаги пост-обработки модельных предсказаний (например, наложение маски по якорным
точкам). Так что, не требуется оборачивать инференс в _user-friendly_ интерфейс
(телеграм бот/веб-сервис).

Планируется реализовать `.py`-скрипт для инференса модели, в который будет
передаваться директория, содержащая изображения для предсказаний.

Для более гибкого использования модели скрипты для обучения и инференса будут вызываться
одним скриптом из терминала. Регулировка режима работы модели (train или inference)
будет осуществлена с помощью CLI-параметров.




